@using QlyDonHang_DoAn_hqtcsdl.Models
@model IEnumerable<Order>

@{
    ViewBag.Title = "Dashboard Tổng Quan";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Style tùy chỉnh để ép giao diện tối cho bảng và card -->
<style>
    /* Ép bảng về màu tối và bỏ nền trắng của Bootstrap */
    .table-cyber-dark {
        --bs-table-bg: #0b1221;
        --bs-table-color: #e2e8f0;
        --bs-table-hover-bg: rgba(255, 255, 255, 0.05);
        --bs-table-border-color: rgba(255, 255, 255, 0.1);
        background-color: #0b1221 !important;
        color: #e2e8f0 !important;
        border-color: rgba(255, 255, 255, 0.1) !important;
    }

        .table-cyber-dark thead th {
            background-color: #151e32 !important;
            color: #ccff00 !important; /* Màu xanh neon cho header */
            border-bottom: 2px solid #7c3aed !important; /* Viền tím neon */
            text-transform: uppercase;
            font-size: 0.85rem;
            box-shadow: none !important;
        }

        .table-cyber-dark tbody td {
            background-color: #0b1221 !important;
            color: #e2e8f0 !important;
            vertical-align: middle;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        /* Hiệu ứng hover cho dòng */
        .table-cyber-dark tbody tr:hover > td {
            background-color: rgba(0, 243, 255, 0.05) !important; /* Xanh dương nhạt khi hover */
            color: #fff !important;
        }

    /* Style cho các Card thống kê */
    .cyber-card {
        background-color: #0b1221;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        /* Thêm viền trái màu tím mặc định cho tất cả card */
        border-left: 4px solid #7c3aed;
    }

    /* Ghi đè màu viền trái đồng bộ tím neon */
    .card-revenue, .card-order, .card-customer, .card-product {
        border-left-color: #7c3aed !important;
    }
</style>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger border-danger bg-dark text-danger">
        <i class="fas fa-exclamation-triangle me-2"></i> @ViewBag.Error
    </div>
}

<div class="row g-4 mb-4">
    <!-- Card Doanh thu Tháng -->
    <div class="col-md-3">
        <div class="cyber-card p-3 card-revenue">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-secondary text-uppercase mb-2" style="font-size: 0.8rem;">Doanh Thu T@(ViewBag.CurrentMonth)</h6>
                    <h3 class="text-info fw-bold m-0">
                        @string.Format("{0:N0}", ViewBag.MonthlyRevenue ?? 0) ₫
                    </h3>
                </div>
                <div class="fs-1 text-info opacity-50"><i class="fas fa-coins"></i></div>
            </div>
        </div>
    </div>

    <!-- Card Đơn hàng -->
    <div class="col-md-3">
        <div class="cyber-card p-3 card-order">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-secondary text-uppercase mb-2" style="font-size: 0.8rem;">Tổng Đơn Hàng</h6>
                    <h3 class="text-warning fw-bold m-0">@ViewBag.TotalOrders</h3>
                </div>
                <div class="fs-1 text-warning opacity-50"><i class="fas fa-shopping-cart"></i></div>
            </div>
        </div>
    </div>

    <!-- Card Khách hàng -->
    <div class="col-md-3">
        <div class="cyber-card p-3 card-customer">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-secondary text-uppercase mb-2" style="font-size: 0.8rem;">Tổng Khách Hàng</h6>
                    <h3 class="text-success fw-bold m-0">@ViewBag.TotalCustomers</h3>
                </div>
                <div class="fs-1 text-success opacity-50"><i class="fas fa-users"></i></div>
            </div>
        </div>
    </div>

    <!-- Card Sản phẩm -->
    <div class="col-md-3">
        <div class="cyber-card p-3 card-product">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-secondary text-uppercase mb-2" style="font-size: 0.8rem;">Tồn Kho Tổng</h6>
                    <h3 class="text-danger fw-bold m-0">@ViewBag.TotalProducts</h3>
                </div>
                <div class="fs-1 text-danger opacity-50"><i class="fas fa-cubes"></i></div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Bảng Đơn hàng mới nhất -->
    <div class="col-md-8">
        <div class="cyber-card p-4 h-100" style="background-color: #0b1221;">
            <h5 class="text-white mb-4 border-bottom border-secondary pb-2">
                <i class="fas fa-clock me-2 text-info"></i>Đơn Hàng Mới Nhất
            </h5>

            <div class="table-responsive">
                <!-- Áp dụng class table-cyber-dark đã định nghĩa ở trên -->
                <table class="table table-hover mb-0 align-middle table-cyber-dark">
                    <thead>
                        <tr>
                            <th class="ps-3">Mã ĐH</th>
                            <th>Ngày Đặt</th>
                            <th>Khách Hàng</th>
                            <th>Tổng Tiền</th>
                            <th>Trạng Thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Count() > 0)
                        {
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-info ps-3 fw-bold">#@item.OrderNo</td>
                                    <td>@string.Format("{0:dd/MM/yyyy HH:mm}", item.OrderDate)</td>

                                    <td class="fw-bold">
                                        @(item.KhachHang != null ? item.KhachHang.TenKH : "Khách vãng lai")
                                    </td>

                                    <td class="text-warning fw-bold">@string.Format("{0:N0}", item.TotalAmount) ₫</td>

                                    <td>
                                        @{
                                            string badgeClass = "bg-secondary";
                                            string status = item.Status ?? "";
                                            if (status.Contains("Hoàn thành")) { badgeClass = "bg-success"; }
                                            else if (status.Contains("Hủy")) { badgeClass = "bg-danger"; }
                                            else if (status.Contains("Giao")) { badgeClass = "bg-primary"; }
                                            else if (status.Contains("Chờ")) { badgeClass = "bg-warning text-dark"; }
                                        }
                                        <span class="badge @badgeClass bg-opacity-75">@item.Status</span>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">Chưa có dữ liệu đơn hàng mới.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Panel Trạng thái hệ thống -->
    <div class="col-md-4">
        <div class="cyber-card p-4 h-100" style="background-color: #0b1221; border-left: 4px solid #7c3aed;">
            <h5 class="text-white mb-4"><i class="fas fa-server me-2 text-primary"></i>Trạng Thái Hệ Thống</h5>
            <ul class="list-unstyled text-secondary">
                <li class="mb-3 d-flex justify-content-between border-bottom border-secondary pb-2">
                    <span>Database:</span>
                    <span class="@(ViewBag.Error == null ? "text-success" : "text-danger") fw-bold">
                        @(ViewBag.Error == null ? "Online" : "Offline") <i class="fas fa-circle ms-1 small"></i>
                    </span>
                </li>
                <li class="mb-3 d-flex justify-content-between border-bottom border-secondary pb-2">
                    <span>Server Time:</span>
                    <span class="text-white font-monospace">@DateTime.Now.ToString("HH:mm:ss")</span>
                </li>
                <li class="mb-3 d-flex justify-content-between">
                    <span>Phiên bản:</span>
                    <span class="text-info">v1.0.2 (Beta)</span>
                </li>
            </ul>
        </div>
    </div>
</div>